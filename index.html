<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>¿Dónde Comemos?</title>

    <!-- METAS -->
    <meta property="og:title" content="¿Dónde Comemos?"/>
    <meta property="og:type" content="website" />
    <meta property="og:site-name" content="¿Dónde Comemos?"/>
    <meta property="og:url" content="https://wecarrasco.github.io/dondecomemos_suscribe"/>
    <meta property="og:description" content="¿Dónde Comemos? es la aplicación que te ayudará a decidir que comeras tomando en cuenta tu ubicación, gustos y presupuesto.">
    <meta property="og:image" content="restaurante.jpg">

    <!-- gmaps.js -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACWRPhDuIJszw-aqix0lVacdSEL9GICUc"></script>
    <script src="https://rawgit.com/HPNeo/gmaps/master/gmaps.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="sweetalert.css">
    <link rel="stylesheet" href="master.css">
  </head>
  <body>

    <div class="container">
      <h1>¿Dónde Comemos?</h1>
      <h2>Nosotros somos Lempira Workstation y estamos creando la aplicación "¿Dónde Comemos?", la cual te ayudará a conocer lugares nuevos donde podes comer, tomando en cuenta tu ubicación, gustos y presupuesto.</h2>
      <h2>¿Quiéres que tus restaurantes favoritos aparezcan en nuestra aplicación para no perderte de ninguna promoción? Llena el siguiente formulario y nosotros lo integraremos</h2>
      <form action="#" class="form">
        <div class="input-group">
          <span class="input-group-addon">Nombre del Restaurante:</span>
          <input type="text" class="form-control"  placeholder="Ej. Carnitas del Anillo" id="nomRest">
        </div>
        <div class="input-group">
          <span class="input-group-addon">Página de Facebook:</span>
          <input type="text" class="form-control"  placeholder="Ej. https://www.facebook.com/CARNITAS-DEL-ANILLO-158115617583746/" id="pagina">
        </div>
        <div class="input-group">
          <span class="input-group-addon">Tags:</span>
          <input type="text" class="form-control"  placeholder="Ej. Carne, baleadas, pupusas, anillo, carnitas" id="tags">
        </div>
        <div class="input-group">
          <span class="input-group-addon">Dirección:</span>
          <input type="text" class="form-control"  placeholder="Ej. Col. Hato" id="direccion">
        </div>
        <h2>Si conoces aproximadamente dónde queda el restaurante, haz click en la ubicación en el siguiente mapa</h2>
        <br>
        <div id="map"></div>
        <hr>
        <h2>¿Quieres ser el primero en saber cuando lancemos la apliación? Llena los siguientes datos y nosotros te informaremos</h2>
        <div class="input-group">
          <span class="input-group-addon">Nombre:</span>
          <input type="text" class="form-control"  placeholder="Ej. Juanito Pérez" id="nombre">
        </div>
        <div class="input-group">
          <span class="input-group-addon">Correo:</span>
          <input type="email" class="form-control"  placeholder="Ej. correo@gmail.com" id="correo">
        </div>
        <button class="btn btn-primary btn-lg btn-block" onclick="enviarDatos(); return false;">ENVIAR</button>
      </form>
    </div>

    <!-- SCRIPTS -->

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- <script src="https://raw.githubusercontent.com/HPNeo/gmaps/master/gmaps.js"></script> -->
    <script src="sweetalert.min.js"></script>
    <script type="text/javascript">
      let map;
      let latitud;
      let longitud;
      $(document).ready(function(){
         map = new GMaps({
          el: '#map',
          lat:-12.043333,
          lng: -77.028333,
          click: function(e){
            map.removeMarkers();
            latitud = e.latLng.lat();
            longitud = e.latLng.lng();
            map.addMarker({
              position: e.latLng,
              title: "Tu Restaurante Favorito"
            });
          }
        });

        GMaps.geolocate({
          success: function(position){
            map.setCenter(position.coords.latitude, position.coords.longitude);
          },
          error: function(error){
            alert('Geolocation failed: '+error.message);
          },
          not_supported: function(){
            alert("Your browser does not support geolocation");
          }
        });

        google.maps.event.trigger(map, 'resize');

        // google.maps.event.addListener(map, "click", function(e){
        //   map.removeMarkers();
        //   alert("entra");
        //   latitud = e.latLng.lat();
        //   longitud = e.latLng.lng();
        //   map.addMarker({
        //     position: e.latLng,
        //     title: "Tu Restaurante Favorito"
        //   });
        // });

      });

      function enviarDatos(){
        let nombreRestaurante = $("#nomRest").val();
        let pagina = $("#pagina").val();
        let tags = $("#tags").val();
        let direccion = $("#direccion").val();
        let nombre = $("#nombre").val();
        let correo = $("#correo").val();
        if(nombreRestaurante === ""){
          swal("Oops...", "Necesitas escribir al menos el nombre del restaurante", "error");
          map.removeMarkers();
        }else{
          if (nombre === "" && correo === "") {
            let object ={
              "nombreRestaurante" : nombreRestaurante,
              "pagina" : pagina,
              "tags" : tags,
              "direccion" : direccion,
              "latitud" : latitud,
              "longitud" : longitud
            }
            $.post("https://dondecomemos-suscribe.herokuapp.com/v1/agregar", object, function(data){
            //$.post("http://localhost:8000/v1/agregar", object, function(data){
              console.log(data);
            });
            $('.form')[0].reset();
            map.removeMarkers();
            swal("Gracias!", "Agregaremos tu restaurante favorito a nuestra aplicación!", "success");
          }else{
            let object ={
              "nombreRestaurante" : nombreRestaurante,
              "pagina" : pagina,
              "tags" : tags,
              "direccion" : direccion,
              "latitud" : latitud,
              "longitud" : longitud,
              "nombre" : nombre,
              "correo" : correo
            }
            $.post("https://dondecomemos-suscribe.herokuapp.com/v1/agregar", object, function(data){
              console.log(data);
            });
            $('.form')[0].reset();
            map.removeMarkers();
            swal("Gracias!", "Agregaremos tu restaurante favorito a nuestra aplicación!", "success");
          }
        }
      }
    </script>
  </body>
</html>
